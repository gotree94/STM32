# Chapter 02: Classic Platform 아키텍처

[← 이전 챕터](../Chapter_01_Introduction/README.md) | [메인으로 돌아가기](../README.md) | [다음 챕터 →](../Chapter_03_BSW_Layers/README.md)

---

## 📋 목차

1. [학습 목표](#1-학습-목표)
2. [Classic Platform 개요](#2-classic-platform-개요)
3. [계층형 소프트웨어 아키텍처](#3-계층형-소프트웨어-아키텍처)
4. [Virtual Functional Bus (VFB)](#4-virtual-functional-bus-vfb)
5. [Software Component (SWC)](#5-software-component-swc)
6. [포트와 인터페이스](#6-포트와-인터페이스)
7. [요약 및 연습 문제](#7-요약-및-연습-문제)

---

## 1. 학습 목표

```
✅ Classic Platform의 3계층 구조 이해 (Application, RTE, BSW)
✅ Virtual Functional Bus (VFB) 개념과 역할 파악
✅ Software Component의 구성 요소 이해
✅ 포트(Port)와 인터페이스(Interface)의 종류와 용도 구분
```

---

## 2. Classic Platform 개요

### 2.1 Classic Platform의 특징

```
┌─────────────────────────────────────────────────────────────────┐
│                 Classic Platform 핵심 특징                       │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  🎯 대상 하드웨어: 마이크로컨트롤러 (MCU)                         │
│     - 8-bit, 16-bit, 32-bit MCU                                │
│     - 제한된 메모리 (Flash: ~2MB, RAM: ~512KB)                  │
│                                                                 │
│  ⏱️ 실시간 특성:                                                 │
│     - 결정론적(Deterministic) 동작                              │
│     - 하드 실시간 요구사항 충족                                  │
│     - OSEK/VDX 기반 RTOS                                       │
│                                                                 │
│  🏗️ 아키텍처 특성:                                               │
│     - 정적 구성 (컴파일 타임에 결정)                             │
│     - Signal-based 통신                                        │
│     - 정적 메모리 할당                                          │
│                                                                 │
│  🔧 개발 언어: C (MISRA-C 준수)                                  │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

### 2.2 적용 대상 ECU

| 도메인 | ECU 예시 | 특징 |
|--------|---------|------|
| **파워트레인** | ECM, TCU, BMS | 엔진/변속기/배터리 제어 |
| **섀시** | ABS, ESC, EPS | 안전 필수 제동/조향 |
| **바디** | BCM, PEPS, RKE | 바디 전자장치 제어 |
| **안전** | Airbag ECU, SRS | 충돌 안전 시스템 |

---

## 3. 계층형 소프트웨어 아키텍처

### 3.1 3계층 구조 개요

```
┌─────────────────────────────────────────────────────────────────┐
│                  AUTOSAR Classic 계층 구조                       │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │              Application Layer (ASW)                     │   │
│  │  ┌─────────┐  ┌─────────┐  ┌─────────┐  ┌─────────┐    │   │
│  │  │  SWC 1  │  │  SWC 2  │  │  SWC 3  │  │  SWC n  │    │   │
│  │  └────┬────┘  └────┬────┘  └────┬────┘  └────┬────┘    │   │
│  └───────┼────────────┼────────────┼────────────┼──────────┘   │
│          │            │            │            │              │
│  ┌───────┴────────────┴────────────┴────────────┴──────────┐   │
│  │              Runtime Environment (RTE)                   │   │
│  │         (통신 추상화 및 미들웨어 계층)                      │   │
│  └───────┬────────────┬────────────┬────────────┬──────────┘   │
│          │            │            │            │              │
│  ┌───────┴────────────┴────────────┴────────────┴──────────┐   │
│  │              Basic Software (BSW)                        │   │
│  │  ┌─────────────────────────────────────────────────┐    │   │
│  │  │            Services Layer                        │    │   │
│  │  ├─────────────────────────────────────────────────┤    │   │
│  │  │         ECU Abstraction Layer                    │    │   │
│  │  ├─────────────────────────────────────────────────┤    │   │
│  │  │    Microcontroller Abstraction Layer (MCAL)     │    │   │
│  │  └─────────────────────────────────────────────────┘    │   │
│  └──────────────────────────────────────────────────────────┘   │
│                                                                 │
│  ┌──────────────────────────────────────────────────────────┐   │
│  │                    Microcontroller                        │   │
│  └──────────────────────────────────────────────────────────┘   │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

### 3.2 각 계층의 역할

#### Application Layer (애플리케이션 계층)

- **역할**: 차량의 실제 기능을 구현
- **구성요소**: AUTOSAR Software Components (SWC)
- **특징**: 하드웨어 독립적, RTE를 통해서만 통신

#### Runtime Environment (런타임 환경)

- **역할**: Application Layer와 BSW 사이의 통신 추상화
- **주요 기능**: SWC 간 통신, SWC-BSW 통신, ECU 간 통신
- **생성 방식**: RTE Generator에 의해 자동 생성

#### Basic Software (기본 소프트웨어)

- **역할**: 하드웨어 추상화 및 표준 서비스 제공
- **하위 계층**: Services Layer, ECU Abstraction Layer, MCAL
- **특징**: MCAL은 하드웨어 종속적

---

## 4. Virtual Functional Bus (VFB)

### 4.1 VFB 개념

**VFB(Virtual Functional Bus)** 는 소프트웨어 컴포넌트 간의 통신을 추상화하는 개념입니다.

```
┌─────────────────────────────────────────────────────────────────┐
│                Virtual Functional Bus 개념                       │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│    설계 단계 (Design Time)                                      │
│    ═══════════════════════                                      │
│                                                                 │
│    ┌─────────┐         VFB          ┌─────────┐               │
│    │  SWC A  │◄────────────────────►│  SWC B  │               │
│    │         │    (가상 통신 버스)   │         │               │
│    └─────────┘                       └─────────┘               │
│                                                                 │
│    → SWC들은 VFB를 통해 논리적으로 연결됨                        │
│    → 물리적 ECU 배치와 무관하게 설계 가능                       │
│                                                                 │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│    실행 단계 (Run Time)                                         │
│    ═══════════════════                                          │
│                                                                 │
│    ┌───────────────────┐    ┌───────────────────┐              │
│    │      ECU 1        │    │      ECU 2        │              │
│    │  ┌─────┐          │    │        ┌─────┐   │              │
│    │  │SWC A│          │    │        │SWC B│   │              │
│    │  └──┬──┘          │    │        └──┬──┘   │              │
│    │     │    RTE      │    │    RTE    │      │              │
│    │  ┌──┴──────────┐  │    │  ┌────────┴───┐  │              │
│    │  │    RTE      │  │    │  │    RTE     │  │              │
│    │  └──────┬──────┘  │    │  └──────┬─────┘  │              │
│    │  ┌──────┴──────┐  │    │  ┌──────┴─────┐  │              │
│    │  │    BSW      │◄─┼────┼─►│    BSW     │  │              │
│    │  └─────────────┘  │CAN │  └────────────┘  │              │
│    └───────────────────┘    └───────────────────┘              │
│                                                                 │
│    → VFB는 RTE로 구현되어 실제 통신 수행                        │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

### 4.2 VFB의 장점

| 장점 | 설명 |
|------|------|
| **설계 독립성** | ECU 배치 결정 전에 SW 아키텍처 설계 가능 |
| **유연한 배치** | 동일 SWC를 다른 ECU에 쉽게 재배치 |
| **통신 추상화** | SWC는 통신 방식(CAN, LIN 등)을 알 필요 없음 |
| **재사용성** | 통신 코드 변경 없이 SWC 재사용 |

---

## 5. Software Component (SWC)

### 5.1 SWC 개요

**Software Component(SWC)** 는 AUTOSAR 애플리케이션의 기본 빌딩 블록입니다.

```
┌─────────────────────────────────────────────────────────────────┐
│                    Software Component 구조                       │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│                    ┌─────────────────────────┐                  │
│                    │    Software Component   │                  │
│    ┌───────────────┼─────────────────────────┼───────────────┐ │
│    │               │                         │               │ │
│ P-Port          P-Port                    R-Port         R-Port│
│ (Provide)       (Provide)                 (Require)      (Req) │
│    │               │                         │               │ │
│    └───────────────┼─────────────────────────┼───────────────┘ │
│                    │                         │                  │
│                    │  ┌─────────────────┐   │                  │
│                    │  │   Internal      │   │                  │
│                    │  │   Behavior      │   │                  │
│                    │  │                 │   │                  │
│                    │  │ ┌─────────────┐ │   │                  │
│                    │  │ │ Runnable 1  │ │   │                  │
│                    │  │ └─────────────┘ │   │                  │
│                    │  │ ┌─────────────┐ │   │                  │
│                    │  │ │ Runnable 2  │ │   │                  │
│                    │  │ └─────────────┘ │   │                  │
│                    │  └─────────────────┘   │                  │
│                    │                         │                  │
│                    └─────────────────────────┘                  │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

### 5.2 SWC 종류

| SWC 타입 | 설명 | 예시 |
|----------|------|------|
| **Application SWC** | 일반적인 애플리케이션 로직 | 토크 계산, 속도 제어 |
| **Sensor/Actuator SWC** | 센서/액추에이터 추상화 | 온도 센서, 모터 SWC |
| **Service SWC** | BSW 서비스를 ASW에 제공 | NvM 래퍼, Dem 래퍼 |
| **ECU Abstraction SWC** | ECU 하드웨어 추상화 | I/O 추상화 |
| **Complex Device Driver SWC** | 복잡한 장치 드라이버 | 특수 센서 드라이버 |

### 5.3 Runnable Entity

**Runnable Entity** 는 SWC 내에서 실행 가능한 코드 단위입니다.

| 트리거 유형 | 설명 | 예시 |
|------------|------|------|
| **TimingEvent** | 주기적 실행 | 10ms마다 센서 읽기 |
| **DataReceivedEvent** | 데이터 수신 시 | CAN 메시지 수신 시 |
| **OperationInvokedEvent** | 서비스 호출 시 | 진단 요청 수신 시 |
| **ModeSwitchEvent** | 모드 변경 시 | 시동 ON/OFF 시 |

### 5.4 Runnable 코드 예시

```c
/* SWC: EngineControl */
/* Runnable: CalculateTorque - 10ms 주기로 호출 */

FUNC(void, EngineControl_CODE) CalculateTorque(void)
{
    float32 throttlePosition;
    float32 engineSpeed;
    float32 targetTorque;
    
    /* R-Port에서 데이터 읽기 */
    (void)Rte_Read_RP_ThrottlePosition_value(&throttlePosition);
    (void)Rte_Read_RP_EngineSpeed_value(&engineSpeed);
    
    /* 토크 계산 로직 */
    targetTorque = throttlePosition * engineSpeed * TORQUE_COEFFICIENT;
    
    /* 최대 토크 제한 */
    if (targetTorque > MAX_TORQUE) {
        targetTorque = MAX_TORQUE;
    }
    
    /* P-Port로 데이터 쓰기 */
    (void)Rte_Write_PP_TargetTorque_value(targetTorque);
}
```

---

## 6. 포트와 인터페이스

### 6.1 포트(Port) 개념

```
┌─────────────────────────────────────────────────────────────────┐
│                      포트(Port) 개념                             │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│    ┌─────────────────┐              ┌─────────────────┐        │
│    │    SWC A        │              │    SWC B        │        │
│    │                 │              │                 │        │
│    │    ┌───────┐    │   데이터    │    ┌───────┐    │        │
│    │    │P-Port │────┼─────────────┼───►│R-Port │    │        │
│    │    │(제공) │    │    흐름     │    │(요청) │    │        │
│    │    └───────┘    │              │    └───────┘    │        │
│    │                 │              │                 │        │
│    └─────────────────┘              └─────────────────┘        │
│                                                                 │
│  P-Port (Provide Port): 데이터나 서비스를 제공하는 포트         │
│  R-Port (Require Port): 데이터나 서비스를 요청하는 포트         │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

### 6.2 인터페이스(Interface) 종류

| 인터페이스 | 설명 | 용도 |
|-----------|------|------|
| **Sender-Receiver (S/R)** | 데이터 전송용, 비동기 | 센서 값 전달 |
| **Client-Server (C/S)** | 서비스 호출용, 함수 형태 | 진단 서비스 |
| **Mode-Switch** | 모드 전환 알림 | 시동 ON/OFF |
| **Parameter** | 캘리브레이션 파라미터 접근 | 튜닝 값 읽기 |

### 6.3 Sender-Receiver 통신

```
     Sender SWC                              Receiver SWC
    ┌───────────────┐                      ┌───────────────┐
    │               │    Data Element     │               │
    │  ┌─────────┐  │                      │  ┌─────────┐  │
    │  │ P-Port  │──┼──────────────────────┼──│ R-Port  │  │
    │  └─────────┘  │                      │  └─────────┘  │
    └───────────────┘                      └───────────────┘
    
    /* Sender 측 */                        /* Receiver 측 */
    Rte_Write_PP_Speed_value(speed);       Rte_Read_RP_Speed_value(&speed);
```

### 6.4 Client-Server 통신

```
     Client SWC                              Server SWC
    ┌───────────────┐                      ┌───────────────┐
    │  ┌─────────┐  │    Operation        │  ┌─────────┐  │
    │  │ R-Port  │──┼────── Call ──────────┼──│ P-Port  │  │
    │  │         │◄─┼───── Return ─────────┼──│         │  │
    │  └─────────┘  │                      │  └─────────┘  │
    └───────────────┘                      └───────────────┘
    
    /* Client 측 */
    result = Rte_Call_RP_DiagService_ReadData(dataId, &data);
```

---

## 7. 요약 및 연습 문제

### 핵심 정리

```
┌─────────────────────────────────────────────────────────────────┐
│                    Chapter 02 핵심 정리                          │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  📌 Classic Platform 3계층 구조:                                 │
│     ├── Application Layer (SWC)                                │
│     ├── Runtime Environment (RTE)                              │
│     └── Basic Software (BSW)                                   │
│                                                                 │
│  📌 VFB (Virtual Functional Bus):                               │
│     ├── 설계 시점의 추상적 통신 버스                            │
│     └── RTE로 구현되어 실제 통신 수행                           │
│                                                                 │
│  📌 Software Component (SWC):                                   │
│     ├── 애플리케이션의 기본 빌딩 블록                           │
│     ├── Port를 통해 통신                                        │
│     └── Runnable Entity로 실행 코드 구현                        │
│                                                                 │
│  📌 포트와 인터페이스:                                           │
│     ├── P-Port (Provide), R-Port (Require)                     │
│     ├── Sender-Receiver Interface (데이터 전송)                │
│     └── Client-Server Interface (서비스 호출)                  │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

### 연습 문제

**문제 1.** AUTOSAR Classic Platform의 3계층을 위에서 아래 순서대로 나열하세요.

<details>
<summary>정답</summary>

1. Application Layer (ASW)
2. Runtime Environment (RTE)  
3. Basic Software (BSW)
</details>

**문제 2.** VFB의 역할과 RTE의 관계를 설명하세요.

<details>
<summary>정답</summary>

VFB는 설계 단계에서 SWC 간의 통신을 추상화하는 가상의 통신 버스입니다. 
RTE는 VFB의 실제 구현체로, ECU 설정에 따라 자동 생성됩니다.
</details>

**문제 3.** Sender-Receiver와 Client-Server Interface의 차이점은?

<details>
<summary>정답</summary>

- **S/R**: 데이터 전송용, 비동기 방식
- **C/S**: 서비스 호출용, 함수 형태, 동기/비동기 가능
</details>

---

[← 이전 챕터: Introduction](../Chapter_01_Introduction/README.md) | [메인으로 돌아가기](../README.md) | [다음 챕터: BSW Layers →](../Chapter_03_BSW_Layers/README.md)
