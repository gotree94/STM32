# 매직 라이트컵 모듈 (KY-027 Magic Light Cup Module)

NUCLEO-F103RB 보드를 이용한 매직 라이트컵 모듈 테스트 프로젝트입니다.

## 📋 개요

매직 라이트컵 모듈은 수은 스위치(기울기 센서)와 LED가 결합된 모듈입니다. 모듈을 기울이면 내부 수은이 이동하여 접점이 연결되고, 이를 감지하여 LED를 제어할 수 있습니다. 마치 물이 담긴 컵처럼 기울기에 따라 빛이 움직이는 효과를 만들 수 있습니다.

## 🔧 하드웨어 구성

### 필요 부품
| 부품 | 수량 |
|------|------|
| NUCLEO-F103RB | 1 |
| 매직 라이트컵 모듈 (KY-027) | 1 |
| 점퍼 와이어 | 4 |

### 핀 연결

| 모듈 핀 | NUCLEO 핀 | 설명 |
|---------|-----------|------|
| VCC | 3.3V | 전원 |
| GND | GND | 접지 |
| S (Signal) | PA0 | 수은 스위치 출력 |
| L (LED) | PA1 | LED 제어 (PWM) |

### 회로도

```
NUCLEO-F103RB            매직 라이트컵 모듈
    ┌─────┐               ┌─────────────┐
    │ 3.3V├───────────────┤VCC          │
    │     │               │     💡      │ ← LED
    │  GND├───────────────┤GND    ○     │ ← 수은 스위치
    │     │               │      / \    │
    │  PA0├───────────────┤S (Signal)   │
    │     │               │             │
    │  PA1├───────────────┤L (LED)      │
    └─────┘               └─────────────┘
```

## 💻 소프트웨어 설정

### Arduino IDE 설정
1. **보드 매니저**: STM32 MCU based boards 설치
2. **보드 선택**: Nucleo-64 → Nucleo F103RB
3. **시리얼 포트**: 해당 COM 포트 선택

### 라이브러리
- 기본 라이브러리만 사용 (추가 설치 불필요)

## 📝 동작 모드

시리얼 모니터에서 1-4 숫자를 입력하여 모드 선택:

| 명령 | 모드 | 설명 |
|------|------|------|
| 1 | 기본 | 기울이면 LED ON, 원위치면 OFF |
| 2 | 페이드 | 부드러운 밝기 전환 효과 |
| 3 | 물결 | 물이 차오르고 빠지는 효과 + 출렁임 |
| 4 | 밝기 조절 | 기울인 시간만큼 밝기 증가 |

### 모드 상세 설명

#### 1. 기본 모드 (MODE_BASIC)
- 단순 ON/OFF 제어
- 기울어지면 LED 켜짐, 원위치면 LED 꺼짐

#### 2. 페이드 모드 (MODE_FADE)
- 부드러운 밝기 전환
- 갑작스러운 ON/OFF 대신 점진적 변화

#### 3. 물결 효과 모드 (MODE_WATER)
- 기울이면 물이 차오르듯 밝기 증가
- 원위치면 물이 빠지듯 밝기 감소
- sin() 함수로 출렁이는 효과 추가

#### 4. 밝기 조절 모드 (MODE_BRIGHTNESS)
- 기울인 시간에 비례하여 밝기 증가
- 원위치하면 현재 밝기 유지
- 조명 디밍 제어에 응용 가능

## 🖥️ 시리얼 출력 예시

```
================================
매직 라이트컵 모듈 테스트
NUCLEO-F103RB
================================

명령어:
  1: 기본 모드 (ON/OFF)
  2: 페이드 모드 (부드러운 전환)
  3: 물결 효과 모드
  4: 밝기 조절 모드

모듈을 기울여보세요!

[기울기] 기울어짐 감지
[기울기] 원위치 복귀 (기울어진 시간: 1250ms)
[모드] 밝기 조절 모드
[밝기] 45%
[밝기] 67%
[밝기] 89%
```

## 📊 수은 스위치 동작 원리

```
        정위치                  기울어짐
    ┌───────────┐           ┌───────────┐
    │   ●●●     │           │         ●●│●
    │  (수은)   │    →      │    (수은) │
    │ ─┘   └─  │           │ ─┘   └───│
    │  접점     │           │  접점 연결│
    └───────────┘           └───────────┘
      스위치 OFF               스위치 ON
```

## 🔧 파라미터 조정

| 파라미터 | 기본값 | 설명 |
|----------|--------|------|
| `debounceDelay` | 30ms | 디바운싱 시간 |
| `fadeSpeed` | 10 | 페이드 속도 (클수록 빠름) |

## ⚠️ 주의사항

- **수은 주의**: 수은 스위치 내부에 수은이 들어있습니다. 파손 시 주의!
- **취급 주의**: 강한 충격을 주지 마세요
- **환경**: 고온 환경에서 사용 자제
- **대체품**: 환경 문제로 볼 스위치로 대체되는 추세

## 📚 응용 분야

- 물컵 조명 (기울이면 빛이 "흐르는" 효과)
- 기울기 감지 장치
- 인터랙티브 조명
- 게임 컨트롤러
- 자세 감지

## 🔄 두 개 모듈 사용 시 (양방향 감지)

KY-027 모듈을 두 개 사용하면 양방향 기울기를 감지할 수 있습니다:

```cpp
#define LEFT_SWITCH PA0
#define RIGHT_SWITCH PA2
#define LEFT_LED PA1
#define RIGHT_LED PA3

// 왼쪽으로 기울이면 왼쪽 LED
// 오른쪽으로 기울이면 오른쪽 LED
```

## 🔍 트러블슈팅

| 증상 | 해결 방법 |
|------|----------|
| LED가 켜지지 않음 | LED 핀(L) 배선 확인, PWM 지원 핀 사용 |
| 기울기 감지 안 됨 | 신호 핀(S) 배선 확인 |
| 감지가 불안정함 | debounceDelay 값 증가 |
| 반응이 반대임 | 코드에서 isTilted 로직 반전 |

## 📄 라이선스

MIT License
