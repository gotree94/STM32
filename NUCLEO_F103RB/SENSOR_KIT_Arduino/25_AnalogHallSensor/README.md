# 아날로그 홀센서 모듈 (KY-035 Analog Hall Sensor)

NUCLEO-F103RB 보드를 이용한 아날로그 홀센서 모듈 테스트 프로젝트입니다.

## 📋 개요

홀센서(Hall Effect Sensor)는 자기장을 감지하는 센서입니다. 아날로그 홀센서는 자기장의 세기에 비례하는 아날로그 전압을 출력합니다. 디지털 홀센서와 달리 자기장의 강도와 극성(N/S)을 구분할 수 있습니다.

## 🔧 하드웨어 구성

### 필요 부품
| 부품 | 수량 |
|------|------|
| NUCLEO-F103RB | 1 |
| 아날로그 홀센서 모듈 (KY-035) | 1 |
| 점퍼 와이어 | 3 |
| 테스트용 자석 | 1+ |

### 핀 연결

| 모듈 핀 | NUCLEO 핀 | 설명 |
|---------|-----------|------|
| VCC | 3.3V / 5V | 전원 |
| GND | GND | 접지 |
| Signal | PA0 (A0) | 아날로그 출력 |

### 회로도

```
NUCLEO-F103RB            아날로그 홀센서 모듈
    ┌─────┐               ┌─────────┐
    │ 3.3V├───────────────┤VCC      │
    │     │               │   🧲    │ ← 홀센서
    │  GND├───────────────┤GND      │
    │     │               │         │
    │  PA0├───────────────┤Signal   │
    └─────┘               └─────────┘
                               ↑
                          자석 접근 방향
```

## 💻 소프트웨어 설정

### Arduino IDE 설정
1. **보드 매니저**: STM32 MCU based boards 설치
2. **보드 선택**: Nucleo-64 → Nucleo F103RB
3. **시리얼 포트**: 해당 COM 포트 선택

### 라이브러리
- 기본 라이브러리만 사용 (추가 설치 불필요)

## 📝 동작 모드

### 모드 선택 (1-4)

| 명령 | 모드 | 설명 |
|------|------|------|
| 1 | 기본 | 수동으로 'm' 입력 시 측정 |
| 2 | 모니터링 | 연속 측정 + 시각적 막대 그래프 |
| 3 | 자석 감지 | 근접 센서처럼 접근/이탈 감지 + RPM |
| 4 | 가우스 미터 | 상대적 자기장 세기 표시 |

### 추가 명령

| 명령 | 기능 |
|------|------|
| m | 현재 자기장 측정 |
| c | 영점 보정 (자석 없이 실행) |
| r | RPM 측정 시작/정지 |

## 🖥️ 시리얼 출력 예시

### 기본 측정
```
======== 자기장 측정 결과 ========
Raw 값: 2847 (기준: 2048)
편차: 799
자기장 세기: 39% (상대값)
극성: S극 (또는 N극 반대면)
강도: 보통
==================================
```

### 모니터링 모드
```
[홀센서] [----------◀◀◀◀--|----] -35% | N극 (또는 S극 반대면)
[홀센서] [----------|----▶▶▶▶▶] 48% | S극 (또는 N극 반대면)
[홀센서] [----------|----------] 2% | 감지 안됨
```

### 자석 감지 모드
```
🧲 [감지] 자석 접근! | 극성: S극 (또는 N극 반대면)
       RPM: 120.5
    [감지] 자석 이탈
```

### 가우스 미터 모드
```
[가우스] ~450 mG (상대값) | [█████████░░░░░░░░░░░] S극
[가우스] ~120 mG (상대값) | [██░░░░░░░░░░░░░░░░░░] N극
```

## 📊 홀 효과 원리

```
       자기장 없음              N극 접근               S극 접근
    ┌─────────────┐        ┌─────────────┐        ┌─────────────┐
    │             │        │      N      │        │      S      │
    │   ┌───┐     │        │      ↓      │        │      ↓      │
    │   │ H │ 2.5V│   →    │   ┌───┐     │   →    │   ┌───┐     │
    │   └───┘     │        │   │ H │ <2.5V        │   │ H │ >2.5V
    │             │        │   └───┘     │        │   └───┘     │
    └─────────────┘        └─────────────┘        └─────────────┘
       기준 전압              전압 감소               전압 증가
```

## 📊 자기장 감지 범위

| Raw 값 편차 | 감지 상태 |
|-------------|----------|
| 0 - 100 | 감지 안됨 |
| 100 - 500 | 약한 자기장 |
| 500 - 1000 | 보통 자기장 |
| 1000 이상 | 강한 자기장 |

## 🔧 파라미터 조정

| 파라미터 | 기본값 | 설명 |
|----------|--------|------|
| `FILTER_SIZE` | 20 | 이동평균 필터 크기 |
| `DETECT_THRESHOLD` | 100 | 자석 감지 임계값 |
| `STRONG_THRESHOLD` | 500 | 강한 자기장 임계값 |
| `zeroPoint` | 2048 | 영점 기준값 (보정으로 변경) |

## ⚙️ 영점 보정

정확한 측정을 위해 사용 전 영점 보정을 권장합니다:

1. 센서 주변에서 **모든 자석 제거**
2. 시리얼 모니터에서 **'c' 입력**
3. 보정 완료 메시지 확인

## 📊 디지털 vs 아날로그 홀센서

| 특성 | 디지털 홀센서 | 아날로그 홀센서 |
|------|-------------|----------------|
| 출력 | HIGH/LOW | 0V ~ VCC |
| 극성 감지 | 불가 (일부 가능) | 가능 |
| 세기 측정 | 불가 | 가능 |
| 회로 | 간단 | ADC 필요 |
| 가격 | 저렴 | 약간 비쌈 |

## 📚 응용 분야

- **회전수(RPM) 측정**: 회전체에 자석 부착
- **비접촉 위치 감지**: 자석 위치 추적
- **전류 측정**: 자기장을 통한 간접 측정
- **도어/리드 센서**: 자석 근접 감지
- **나침반**: 지자기 감지 (감도 낮음)
- **BLDC 모터 위치 감지**

## 🔄 RPM 측정 방법

회전체에 자석을 부착하고 센서 근처에서 회전:

```
         자석
          ●
         ╱
    ○───╱───○    ← 회전체
       ╱
      ╱
   [센서]

   한 바퀴 = 한 번 감지
   RPM = 60000 / 펄스간격(ms)
```

## ⚠️ 주의사항

- **자석 거리**: 감지 거리는 일반적으로 수 cm 이내
- **자석 강도**: 네오디뮴 자석 권장
- **간섭**: 주변 자기장(모터, 스피커 등) 영향 가능
- **온도**: 고온에서 감도 변화 가능
- **정밀도**: 정밀 측정에는 전용 가우스미터 필요

## 🔍 트러블슈팅

| 증상 | 해결 방법 |
|------|----------|
| 값이 변하지 않음 | 더 강한 자석 사용, 거리 가깝게 |
| 값이 불안정함 | 필터 크기 증가, 주변 자기장 확인 |
| 극성이 반대로 표시 | 센서 방향 또는 자석 극성 확인 |
| 영점이 맞지 않음 | 'c' 명령으로 영점 보정 |

## 📄 라이선스

MIT License
