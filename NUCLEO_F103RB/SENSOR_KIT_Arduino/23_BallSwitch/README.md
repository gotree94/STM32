# 볼 스위치 모듈 (KY-017 Ball Switch Module)

NUCLEO-F103RB 보드를 이용한 볼 스위치 모듈 테스트 프로젝트입니다.

## 📋 개요

볼 스위치 모듈은 내부에 작은 금속 볼이 있어 움직임이나 기울기를 감지합니다. 각도 스위치보다 민감하여 미세한 진동이나 움직임도 감지할 수 있습니다. 움직임 감지, 흔들기 감지 등에 활용됩니다.

## 🔧 하드웨어 구성

### 필요 부품
| 부품 | 수량 |
|------|------|
| NUCLEO-F103RB | 1 |
| 볼 스위치 모듈 (KY-017) | 1 |
| 점퍼 와이어 | 3 |

### 핀 연결

| 모듈 핀 | NUCLEO 핀 | 설명 |
|---------|-----------|------|
| VCC | 3.3V / 5V | 전원 |
| GND | GND | 접지 |
| Signal | PA0 | 디지털 출력 |

### 회로도

```
NUCLEO-F103RB            볼 스위치 모듈
    ┌─────┐               ┌─────────┐
    │ 3.3V├───────────────┤VCC      │
    │     │               │  ┌───┐  │
    │  GND├───────────────┤GND│ ● │  │ ← 금속 볼
    │     │               │  └───┘  │
    │  PA0├───────────────┤Signal   │
    └─────┘               └─────────┘
```

## 💻 소프트웨어 설정

### Arduino IDE 설정
1. **보드 매니저**: STM32 MCU based boards 설치
2. **보드 선택**: Nucleo-64 → Nucleo F103RB
3. **시리얼 포트**: 해당 COM 포트 선택

### 라이브러리
- 기본 라이브러리만 사용 (추가 설치 불필요)

## 📝 동작 모드

시리얼 모니터에서 1-4 숫자를 입력하여 모드 선택:

| 명령 | 모드 | 설명 |
|------|------|------|
| 1 | 기본 | 볼 이동 감지, LED 토글 |
| 2 | 움직임 감지 | 움직임 강도 측정 |
| 3 | 흔들기 감지 | 1초에 5회 이상 흔들기 감지 |
| 4 | 경보 | 움직임 시 경보 발동 |

### 추가 명령

| 명령 | 기능 |
|------|------|
| s | 상태 및 통계 출력 |
| r | 통계 리셋 |

## 🖥️ 시리얼 출력 예시

```
================================
볼 스위치 모듈 테스트
NUCLEO-F103RB
================================

명령어:
  1: 기본 모드
  2: 움직임 감지 모드
  3: 흔들기 감지 모드
  4: 경보 모드
  s: 상태 출력
  r: 리셋

모듈을 움직이거나 흔들어보세요!

[상태] 움직임 시작
[감지] 볼 이동 #1
[감지] 볼 이동 #2
[감지] 볼 이동 #3
[상태] 정지됨

[모드] 움직임 감지 모드
       움직임 강도를 측정합니다.
[강도] 보통 (일반 움직임)
[강도] 강함 (빠른 움직임)
[강도] 매우 강함 (흔들림)

[모드] 흔들기 감지 모드
🎉 [흔들기] 흔들기 감지!
```

## 📊 움직임 강도 판정

| 1초당 감지 횟수 | 강도 | 설명 |
|----------------|------|------|
| 1-2회 | 약함 | 미세한 움직임 |
| 3-5회 | 보통 | 일반 움직임 |
| 6-10회 | 강함 | 빠른 움직임 |
| 11회 이상 | 매우 강함 | 흔들림 |

## 📊 센서 동작 원리

```
        정지 상태               움직임/기울기
    ┌─────────────┐         ┌─────────────┐
    │             │         │          ●  │
    │      ●      │   →     │    ●  ●     │
    │    ━━━━━    │         │  ━━━●━━━    │
    │    접점     │         │  접점 변화   │
    └─────────────┘         └─────────────┘
      안정 상태                볼 이동 감지
```

### 감도 특성
- **매우 민감**: 작은 진동에도 반응
- **빠른 반응**: 즉각적인 상태 변화
- **노이즈 주의**: 디바운싱 필수

## 🔧 파라미터 조정

| 파라미터 | 기본값 | 설명 |
|----------|--------|------|
| `debounceDelay` | 20ms | 디바운싱 시간 (볼 스위치는 짧게) |
| `INTENSITY_WINDOW` | 1000ms | 강도 측정 윈도우 |
| `STILL_THRESHOLD` | 2000ms | 정지 판정 시간 |
| `SHAKE_THRESHOLD` | 5회 | 흔들기 판정 기준 |

## 📊 각도 스위치 vs 볼 스위치

| 특성 | 각도 스위치 | 볼 스위치 |
|------|------------|----------|
| 민감도 | 낮음 | 높음 |
| 안정성 | 높음 | 낮음 |
| 반응 속도 | 느림 | 빠름 |
| 노이즈 | 적음 | 많음 |
| 용도 | 기울기 감지 | 움직임/진동 감지 |

## ⚠️ 주의사항

- 매우 민감하므로 **디바운싱 필수**
- 진동이 많은 환경에서는 **오탐 가능**
- 인터럽트 사용 시 **ISR은 간단하게** 유지
- 정밀한 움직임 감지에는 **가속도계 권장**

## 📚 응용 분야

- 움직임 감지 장치
- 흔들어서 작동하는 장치
- 도난 방지 센서
- 게임 컨트롤러 (주사위 굴리기 등)
- 만보계/동작 카운터
- 진동 감지

## 🎮 응용 예시: 주사위 게임

```cpp
// 흔들기 감지 후 랜덤 숫자 생성
if (shakeDetected) {
  int dice = random(1, 7);
  Serial.print("🎲 주사위 결과: ");
  Serial.println(dice);
}
```

## 🔍 트러블슈팅

| 증상 | 해결 방법 |
|------|----------|
| 너무 민감함 | debounceDelay 증가, 진동 격리 |
| 감지 안 됨 | 배선 확인, INPUT_PULLUP 확인 |
| 불규칙한 감지 | 디바운싱 강화, 필터링 추가 |
| 인터럽트 충돌 | ISR 내 코드 최소화 |

## 🔄 더 정밀한 움직임 감지가 필요한 경우

볼 스위치는 디지털 ON/OFF만 제공합니다:

```
정밀 움직임 감지 권장 센서:
- MPU6050 (가속도계 + 자이로)
- ADXL345 (가속도계)
- LIS3DH (가속도계)
```

## 📄 라이선스

MIT License
