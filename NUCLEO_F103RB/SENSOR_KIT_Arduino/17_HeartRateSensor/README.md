# 심박 센서 모듈 (Heart Rate / Pulse Sensor Module)

NUCLEO-F103RB 보드를 이용한 심박 센서 모듈 테스트 프로젝트입니다.

## 📋 개요

심박 센서는 광학적 방식(PPG, Photoplethysmography)으로 심박을 측정합니다. LED가 손가락이나 귓불을 비추고, 포토다이오드가 반사되는 빛의 양 변화를 감지하여 심박을 측정합니다.

## 🔧 하드웨어 구성

### 필요 부품
| 부품 | 수량 |
|------|------|
| NUCLEO-F103RB | 1 |
| 심박 센서 모듈 (KY-039 또는 유사품) | 1 |
| 점퍼 와이어 | 3 |

### 핀 연결

| 모듈 핀 | NUCLEO 핀 | 설명 |
|---------|-----------|------|
| VCC | 3.3V | 전원 (3.3V 권장) |
| GND | GND | 접지 |
| Signal | PA1 (A1) | 아날로그 출력 |

### 회로도

```
NUCLEO-F103RB            심박 센서 모듈
    ┌─────┐               ┌─────────┐
    │ 3.3V├───────────────┤VCC      │
    │     │               │    💚   │ ← LED
    │  GND├───────────────┤GND      │
    │     │               │         │
    │  PA1├───────────────┤Signal   │
    └─────┘               └─────────┘
                               │
                          손가락 위치
```

## 💻 소프트웨어 설정

### Arduino IDE 설정
1. **보드 매니저**: STM32 MCU based boards 설치
2. **보드 선택**: Nucleo-64 → Nucleo F103RB
3. **시리얼 포트**: 해당 COM 포트 선택

### 라이브러리
- 기본 라이브러리만 사용 (추가 설치 불필요)

## 📝 동작 설명

### 측정 원리
1. 센서의 LED가 손가락을 비춤
2. 혈액이 심장 박동에 따라 손가락으로 펌핑
3. 혈액량 변화에 따라 반사광 양이 변화
4. 포토다이오드가 이 변화를 감지
5. 신호 처리를 통해 BPM(분당 심박수) 계산

### 신호 처리
- **이동 평균 필터**: 노이즈 제거
- **임계값 기반 피크 감지**: 심박 감지
- **히스테리시스**: 오동작 방지
- **BPM 버퍼**: 안정적인 심박수 계산

## 🖥️ 시리얼 출력 예시

```
================================
심박 센서 모듈 테스트
NUCLEO-F103RB
================================
손가락을 센서에 가볍게 올려주세요.
너무 세게 누르지 마세요.

♥ 심박 감지! | Raw: 612 | Filtered: 598 | BPM: 72
♥ 심박 감지! | Raw: 625 | Filtered: 610 | BPM: 74
♥ 심박 감지! | Raw: 608 | Filtered: 595 | BPM: 73
```

### 시리얼 플로터 사용
코드 하단의 주석을 해제하면 Arduino IDE의 시리얼 플로터에서 파형을 확인할 수 있습니다.

## 🔧 파라미터 조정

| 파라미터 | 기본값 | 설명 |
|----------|--------|------|
| `threshold` | 550 | 심박 감지 임계값 |
| `FILTER_SIZE` | 10 | 이동평균 필터 크기 |
| `BPM_BUFFER_SIZE` | 5 | BPM 평균 계산용 버퍼 |

센서나 개인에 따라 `threshold` 값을 조정해야 할 수 있습니다.

## ⚠️ 주의사항

- 손가락을 **너무 세게 누르지 마세요** - 혈류가 차단됨
- **가만히** 있어야 정확한 측정 가능
- **주변 광원**이 측정에 영향을 줄 수 있음
- **의료용이 아님** - 참고용으로만 사용
- 3.3V 전원 사용 권장 (5V 사용 시 신호 레벨 확인)

## 📊 정상 심박수 범위

| 상태 | BPM |
|------|-----|
| 안정시 성인 | 60-100 |
| 운동선수 | 40-60 |
| 운동 중 | 100-170 |
| 어린이 | 70-120 |

## 📚 응용 분야

- 피트니스 트래커
- 건강 모니터링
- 스트레스 측정
- 교육용 생체신호 실습

## 🔍 트러블슈팅

| 증상 | 해결 방법 |
|------|----------|
| BPM이 계산되지 않음 | threshold 값 조정 |
| 값이 불안정함 | 손가락 위치 고정, 주변 광원 차단 |
| 항상 0으로 표시 | 배선 확인, 센서 손상 여부 확인 |

## 📄 라이선스

MIT License
