# 고감도 소리센서 모듈 (High Sensitivity Sound Sensor)

NUCLEO-F103RB 보드를 이용한 고감도 소리센서 모듈 테스트 예제입니다.

## 📋 개요

고감도 소리센서 모듈은 LM393 비교기와 고감도 마이크로폰을 탑재하여 주변 소리를 감지합니다. 아날로그 출력과 디지털 출력을 모두 지원하며, 가변저항으로 감도 조절이 가능합니다.

## 🔧 하드웨어 요구사항

- **보드**: NUCLEO-F103RB (STM32F103RBT6)
- **센서**: 고감도 소리센서 모듈 (LM393 기반)
- **점퍼 와이어**: 4개

## 📌 핀 연결

| 소리센서 모듈 | NUCLEO-F103RB | 설명 |
|-------------|---------------|------|
| VCC | 3.3V 또는 5V | 전원 공급 |
| GND | GND | 접지 |
| AO | PA0 (A0) | 아날로그 출력 |
| DO | PA10 (D2) | 디지털 출력 |

### 회로도

```
NUCLEO-F103RB          고감도 소리센서 모듈
    3.3V ─────────────── VCC
    GND  ─────────────── GND
    PA0  ─────────────── AO (아날로그)
    PA10 ─────────────── DO (디지털)
```

## 💻 소프트웨어 설정

### Arduino IDE 설정

1. **보드 매니저에서 STM32 보드 패키지 설치**
   - File → Preferences → Additional Board Manager URLs에 추가:
   ```
   https://github.com/stm32duino/BoardManagerFiles/raw/main/package_stmicroelectronics_index.json
   ```
   
2. **보드 선택**
   - Tools → Board → STM32 Boards → Nucleo-64
   - Board Part Number: Nucleo F103RB

3. **포트 선택**
   - Tools → Port → COMx (해당 포트 선택)

## 📝 코드 설명

### 주요 기능

- **다중 샘플링**: 50회 샘플링으로 노이즈 감소
- **진폭 계산**: max - min 값으로 실제 소리 크기 측정
- **피크 감지**: 최대 진폭값 기록
- **LED 표시**: 소리 감지 시 내장 LED 점등

### 출력 데이터

| 항목 | 설명 | 범위 |
|-----|------|------|
| 아날로그 | ADC 평균값 | 0 ~ 4095 |
| 진폭 | 샘플링 구간 내 최대-최소 차이 | 0 ~ 4095 |
| 피크 | 측정된 최대 진폭 | 0 ~ 4095 |
| 디지털 | 임계값 초과 여부 | HIGH/LOW |

### 주요 상수

```cpp
#define SAMPLE_COUNT       50     // 샘플링 횟수
#define SOUND_THRESHOLD    100    // 소리 감지 임계값
#define NOISE_FLOOR        30     // 노이즈 바닥값
```

## 🖥️ 시리얼 출력 예시

```
================================================
  고감도 소리센서 테스트 (High Sensitivity)
================================================
보드: NUCLEO-F103RB
아날로그 핀: PA0 (A0)
디지털 핀: PA10 (D2)
ADC 해상도: 12비트 (0-4095)
------------------------------------------------
Tip: 모듈의 가변저항으로 감도를 조절하세요.
================================================

아날로그: 2048 | 진폭: 45 | 피크: 45 | 디지털: LOW  | [#####---------------]
아날로그: 2051 | 진폭: 38 | 피크: 45 | 디지털: LOW  | [####----------------]
아날로그: 2055 | 진폭: 312 | 피크: 312 | 디지털: HIGH | >>> 소리 감지! <<< [############--------]
아날로그: 2047 | 진폭: 52 | 피크: 312 | 디지털: LOW  | [#####---------------]
```

## 🔧 감도 조절 방법

1. **하드웨어 조절**: 모듈의 파란색 가변저항을 드라이버로 조절
   - 시계 방향: 감도 증가 (작은 소리도 감지)
   - 반시계 방향: 감도 감소 (큰 소리만 감지)

2. **소프트웨어 조절**: `SOUND_THRESHOLD` 값 변경
   - 값 증가: 더 큰 소리만 감지
   - 값 감소: 작은 소리도 감지

## 📊 응용 예제

### 박수 감지

```cpp
if (soundAmplitude > 200) {
    Serial.println("박수 감지!");
}
```

### 연속 소리 감지

```cpp
static int continuousCount = 0;
if (soundAmplitude > SOUND_THRESHOLD) {
    continuousCount++;
    if (continuousCount > 10) {
        Serial.println("연속 소리 감지!");
    }
} else {
    continuousCount = 0;
}
```

## ⚠️ 주의사항

1. **전원 전압**: 3.3V 사용 시 ADC 값 범위가 최적화됨
2. **노이즈**: 모터, 릴레이 등 전자기 노이즈원과 거리 유지
3. **진동**: 물리적 진동도 소리로 감지될 수 있음
4. **샘플링 속도**: 빠른 소리 감지를 위해 딜레이 최소화

## 🔍 트러블슈팅

| 증상 | 원인 | 해결방법 |
|-----|------|---------|
| 값이 항상 0 | 배선 오류 | VCC, GND, AO 연결 확인 |
| 값이 계속 최대값 | 마이크 손상 또는 과감도 | 가변저항으로 감도 낮춤 |
| 노이즈가 심함 | 전원 불안정 | 커패시터 추가 또는 별도 전원 사용 |
| DO 출력이 변하지 않음 | 감도 설정 문제 | 가변저항 조절 |

## 📄 라이선스

MIT License

## 🔗 참고 자료

- [STM32duino 공식 문서](https://github.com/stm32duino/Arduino_Core_STM32)
- [LM393 데이터시트](https://www.ti.com/lit/ds/symlink/lm393.pdf)
- [NUCLEO-F103RB 핀맵](https://os.mbed.com/platforms/ST-Nucleo-F103RB/)
