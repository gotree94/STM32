# 조도 센서 모듈 (KY-018 Photoresistor / LDR Module)

NUCLEO-F103RB 보드를 이용한 조도 센서 모듈 테스트 프로젝트입니다.

## 📋 개요

조도 센서(LDR, Light Dependent Resistor)는 빛의 양에 따라 저항값이 변하는 센서입니다. 빛이 밝으면 저항이 감소하고, 어두우면 저항이 증가합니다. 이를 이용해 주변 밝기를 측정할 수 있습니다.

## 🔧 하드웨어 구성

### 필요 부품
| 부품 | 수량 |
|------|------|
| NUCLEO-F103RB | 1 |
| 조도 센서 모듈 (KY-018) | 1 |
| 점퍼 와이어 | 3 |

### 핀 연결

| 모듈 핀 | NUCLEO 핀 | 설명 |
|---------|-----------|------|
| VCC | 3.3V | 전원 |
| GND | GND | 접지 |
| Signal | PA0 (A0) | 아날로그 출력 |

### 회로도

```
NUCLEO-F103RB            조도 센서 모듈
    ┌─────┐               ┌─────────┐
    │ 3.3V├───────────────┤VCC      │
    │     │               │   🔆    │ ← LDR
    │  GND├───────────────┤GND      │
    │     │               │         │
    │  PA0├───────────────┤Signal   │
    └─────┘               └─────────┘
```

## 💻 소프트웨어 설정

### Arduino IDE 설정
1. **보드 매니저**: STM32 MCU based boards 설치
2. **보드 선택**: Nucleo-64 → Nucleo F103RB
3. **시리얼 포트**: 해당 COM 포트 선택

### 라이브러리
- 기본 라이브러리만 사용 (추가 설치 불필요)

## 📝 동작 모드

### 모드 선택 (1-4)

| 명령 | 모드 | 설명 |
|------|------|------|
| 1 | 기본 | 수동으로 'm' 입력 시 측정 |
| 2 | 모니터링 | 500ms 간격 연속 측정 + 막대 그래프 |
| 3 | 자동 LED | 어두우면 LED 밝아짐 (역비례) |
| 4 | 임계값 알림 | 설정 밝기 초과/미만 시 알림 |

### 추가 명령

| 명령 | 기능 | 예시 |
|------|------|------|
| m | 현재 조도 측정 | m |
| t | 임계값 설정 | t50 (50%로 설정) |

## 🖥️ 시리얼 출력 예시

### 기본 측정
```
======== 조도 측정 결과 ========
Raw 값: 2847 / 4095
밝기: 69%
상태: 보통 🌓
================================
```

### 모니터링 모드
```
[조도] 72% [██████████████░░░░░░] 보통 🌓
[조도] 85% [█████████████████░░░] 밝음 🌔
[조도] 23% [████░░░░░░░░░░░░░░░░] 어두움 🌒
```

### 자동 LED 모드
```
[자동LED] 조도: 25% → LED: 75%
[자동LED] 조도: 80% → LED: 20%
```

### 임계값 알림 모드
```
💡 [알림] 밝기가 임계값(50%)을 초과했습니다!
🌙 [알림] 밝기가 임계값(50%) 아래로 떨어졌습니다!
```

### 급격한 변화 감지
```
⚡ [이벤트] 급격한 조도 변화 감지! (75% → 12%)
```

## 📊 조도 레벨 기준

| Raw 값 (12-bit) | 밝기 | 상태 |
|-----------------|------|------|
| 0 - 500 | 0-12% | 매우 어두움 🌑 |
| 500 - 1500 | 12-36% | 어두움 🌒 |
| 1500 - 2500 | 36-61% | 보통 🌓 |
| 2500 - 3500 | 61-85% | 밝음 🌔 |
| 3500 - 4095 | 85-100% | 매우 밝음 🌕 |

## 📊 LDR 동작 원리

```
밝을 때:                    어두울 때:
    ☀️                         🌙
    ↓                          ↓
  ┌─────┐                   ┌─────┐
  │ LDR │ 저항 ↓            │ LDR │ 저항 ↑
  └─────┘                   └─────┘
    ↓                          ↓
  출력 전압 ↑                출력 전압 ↓
  (ADC 값 높음)              (ADC 값 낮음)
```

## 🔧 파라미터 조정

| 파라미터 | 기본값 | 설명 |
|----------|--------|------|
| `FILTER_SIZE` | 10 | 이동평균 필터 크기 |
| `CHANGE_THRESHOLD` | 10% | 급격한 변화 감지 기준 |
| `LEVEL_DARK` | 500 | 어두움 판정 기준 |
| `LEVEL_BRIGHT` | 3500 | 밝음 판정 기준 |

## 📈 시리얼 플로터 사용

Arduino IDE의 시리얼 플로터로 조도 변화를 그래프로 볼 수 있습니다:

```cpp
// loop() 내에 추가
Serial.println(average);  // 시리얼 플로터용
```

## ⚠️ 주의사항

- LDR은 **빛의 양에 비선형 반응**합니다
- **온도**에 따라 특성이 약간 변할 수 있음
- **반응 속도**가 느린 편 (수십~수백 ms)
- 정밀 측정에는 **Lux 센서 (BH1750 등)** 권장

## 📚 응용 분야

- 자동 조명 시스템
- 스마트 가로등
- 식물 재배 조명 제어
- 디스플레이 자동 밝기
- 일출/일몰 감지
- 보안 시스템 (손전등 감지)

## 🔄 정밀 조도 측정이 필요한 경우

LDR은 상대적 밝기 측정에 적합합니다. 정확한 Lux 측정이 필요하면:

```
정밀 조도 센서 추천:
- BH1750 (I2C, 1-65535 Lux)
- TSL2561 (I2C, 넓은 범위)
- VEML7700 (I2C, 고정밀)
```

## 📊 실제 환경 조도 참고값

| 환경 | 대략적 Lux |
|------|-----------|
| 달빛 | 0.1 |
| 촛불 (1m) | 10 |
| 거실 조명 | 100-300 |
| 사무실 | 300-500 |
| 흐린 날 야외 | 1,000-10,000 |
| 맑은 날 야외 | 50,000-100,000 |

## 🔍 트러블슈팅

| 증상 | 해결 방법 |
|------|----------|
| 값이 항상 최대 | 센서 손상 또는 배선 오류 |
| 값이 항상 0 | GND/VCC 배선 확인 |
| 값이 불안정 | 필터 크기 증가, 노이즈 차폐 |
| 반응이 느림 | LDR 특성상 정상, 더 빠른 센서 고려 |

## 📄 라이선스

MIT License
