# ê°ë„ ìŠ¤ìœ„ì¹˜ ëª¨ë“ˆ (Tilt Switch Module) - STM32F103

## ğŸ“‹ ê°œìš”

* ê°ë„ ìŠ¤ìœ„ì¹˜ ëª¨ë“ˆ(KY-020)ì€ ë‚´ë¶€ì˜ ê¸ˆì† ë³¼ì´ ê¸°ìš¸ê¸°ì— ë”°ë¼ ë‘ ì ‘ì ì„ ì—°ê²°í•˜ê±°ë‚˜ ë¶„ë¦¬í•˜ëŠ” ë””ì§€í„¸ ì„¼ì„œì…ë‹ˆë‹¤. 
* íŠ¹ì • ì„ê³„ ê°ë„ ì´ìƒ ê¸°ìš¸ì–´ì§€ë©´ ìŠ¤ìœ„ì¹˜ê°€ ON ìƒíƒœê°€ ë©ë‹ˆë‹¤.

## ğŸ”§ í•˜ë“œì›¨ì–´ êµ¬ì„±

### ì„¼ì„œ ëª¨ë“ˆ ì‚¬ì–‘

| í•­ëª© | ì‚¬ì–‘ |
|------|------|
| ë™ì‘ ì „ì•• | 3.3V ~ 5V |
| ì¶œë ¥ íƒ€ì… | ë””ì§€í„¸ (HIGH/LOW) |
| ê°ì§€ ê°ë„ | ì•½ 15Â° ~ 45Â° (ì œí’ˆë§ˆë‹¤ ìƒì´) |
| ì‘ë‹µ ì‹œê°„ | 2ms ì´ë‚´ |
| ì ‘ì  ìˆ˜ëª… | 100,000íšŒ ì´ìƒ |

### í•€ ì—°ê²°

```
Tilt Switch Module          NUCLEO-F103RB
==================          ===============
    S (Signal)  --------->  PA0 (EXTI0)
    + (VCC)     --------->  3.3V
    - (GND)     --------->  GND
```

### íšŒë¡œë„

```
      +3.3V
        â”‚
        â”œâ”€â”€â”€â”€â”€â”€[10kÎ©]â”€â”€â”€â”€â”€â”€â”
        â”‚                   â”‚
    â”Œâ”€â”€â”€â”´â”€â”€â”€â”               â”‚
    â”‚ Tilt  â”‚               â”‚
    â”‚Switch â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€> PA0 (EXTI0)
    â”‚  â—‹    â”‚               â”‚
    â”‚  â†“    â”‚               â”‚
    â”‚ â—‹â—‹â—‹   â”‚               â”‚
    â””â”€â”€â”€â”¬â”€â”€â”€â”˜               â”‚
        â”‚                   â”‚
       GND                 GND

    â€» ëª¨ë“ˆ ë‚´ì¥ í’€ì—… ì €í•­ ì‚¬ìš© ë˜ëŠ” MCU ë‚´ë¶€ í’€ì—… í™œì„±í™”
```

## ğŸ’» ì†Œí”„íŠ¸ì›¨ì–´ êµ¬ì„±

### ì£¼ìš” ê¸°ëŠ¥

1. **ì™¸ë¶€ ì¸í„°ëŸ½íŠ¸ ê°ì§€**: ìƒìŠ¹/í•˜ê°• ì—£ì§€ ëª¨ë‘ ê°ì§€
2. **ë””ë°”ìš´ì‹± ì²˜ë¦¬**: 50ms ì†Œí”„íŠ¸ì›¨ì–´ ë””ë°”ìš´ìŠ¤
3. **ì´ë²¤íŠ¸ ì¹´ìš´íŒ…**: ê¸°ìš¸ê¸° ë³€í™” íšŸìˆ˜ ê¸°ë¡
4. **LED í”¼ë“œë°±**: ê¸°ìš¸ê¸° ìƒíƒœì— ë”°ë¥¸ ë³´ë“œ LED ì œì–´

### í•µì‹¬ ì½”ë“œ ì„¤ëª…

```c
/* ì™¸ë¶€ ì¸í„°ëŸ½íŠ¸ ì½œë°± í•¨ìˆ˜ */
void HAL_GPIO_EXTI_Callback(uint16_t GPIO_Pin) {
    if (GPIO_Pin == TILT_PIN) {
        uint32_t current_time = HAL_GetTick();
        
        /* ë””ë°”ìš´ì‹±: 50ms ì´ë‚´ ì¬íŠ¸ë¦¬ê±° ë¬´ì‹œ */
        if ((current_time - last_interrupt_time) > DEBOUNCE_DELAY_MS) {
            tilt_state = HAL_GPIO_ReadPin(TILT_PORT, TILT_PIN);
            tilt_changed = 1;
            last_interrupt_time = current_time;
        }
    }
}
```

### ì¸í„°ëŸ½íŠ¸ ì„¤ì •

| íŒŒë¼ë¯¸í„° | ê°’ | ì„¤ëª… |
|----------|-----|------|
| í•€ | PA0 | EXTI Line 0 |
| ëª¨ë“œ | IT_RISING_FALLING | ì–‘ë°©í–¥ ì—£ì§€ ê°ì§€ |
| í’€ì—… | Internal Pull-up | 10kÎ© ë“±ê°€ |
| ìš°ì„ ìˆœìœ„ | 2 | ì¤‘ê°„ ìš°ì„ ìˆœìœ„ |

## ğŸ“ í”„ë¡œì íŠ¸ êµ¬ì¡°

```
02_angle_switch/
â”œâ”€â”€ main.c              # ë©”ì¸ ì• í”Œë¦¬ì¼€ì´ì…˜
â”œâ”€â”€ README.md           # í”„ë¡œì íŠ¸ ë¬¸ì„œ
â””â”€â”€ STM32CubeIDE/       # (ì„ íƒ) IDE í”„ë¡œì íŠ¸ íŒŒì¼
```

## ğŸš€ ë¹Œë“œ ë° ì‹¤í–‰

### STM32CubeIDE ì‚¬ìš©

1. ìƒˆ STM32 í”„ë¡œì íŠ¸ ìƒì„± (NUCLEO-F103RB ì„ íƒ)
2. `main.c` ë‚´ìš©ì„ í”„ë¡œì íŠ¸ì— ë³µì‚¬
3. ë¹Œë“œ ë° ë‹¤ìš´ë¡œë“œ

### í„°ë¯¸ë„ í™•ì¸

```bash
screen /dev/ttyACM0 115200
```

### ì˜ˆìƒ ì¶œë ¥

```
========================================
  Tilt/Angle Switch Module Test
  Board: NUCLEO-F103RB
========================================

Tilt the module to detect angle changes.
Using external interrupt with debouncing.

Initial state: LEVEL

[    1] >>> TILTED - Module is angled
[    2] === LEVEL - Module is horizontal
[    3] >>> TILTED - Module is angled
...
```

## ğŸ¯ ë™ì‘ ì›ë¦¬

```
    [ìˆ˜í‰ ìƒíƒœ]              [ê¸°ìš¸ì¸ ìƒíƒœ]
    
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚   â—‹     â”‚              â”‚         â”‚
    â”‚  Metal  â”‚  â”€â”€â”€â”€â”€â”€â”€â”€>   â”‚     â—‹   â”‚
    â”‚   Ball  â”‚              â”‚   Metal â”‚
    â”‚ â•â•â•â•â•â•â• â”‚              â”‚ â•â•â•â•â•â•â• â”‚
    â”‚ Contact â”‚              â”‚ Contact â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚                        â”‚
      Switch                   Switch
       OPEN                    CLOSED
         â”‚                        â”‚
    Output: HIGH            Output: LOW
```

### ìƒíƒœ ì „ì´ë„

```
         ê¸°ìš¸ì„
  LEVEL â”€â”€â”€â”€â”€â”€â”€â”€> TILTED
    â”‚               â”‚
    â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
         ìˆ˜í‰ ë³µê·€
         
  State  â”‚ Output â”‚  LED
  â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€
  LEVEL  â”‚  HIGH  â”‚  OFF
  TILTED â”‚  LOW   â”‚  ON
```

## ğŸ“Œ ì‘ìš© ì•„ì´ë””ì–´

1. **ë„ë‚œ ë°©ì§€ ì„¼ì„œ**: ë¬¼ì²´ ì´ë™ ê°ì§€ ì•ŒëŒ
2. **ìì„¸ ëª¨ë‹ˆí„°ë§**: ì˜ì ê¸°ìš¸ê¸° ê°ì§€
3. **ìë™ ì ˆì „**: ì¥ì¹˜ ì‚¬ìš© ì—¬ë¶€ ê°ì§€
4. **ì¥ë‚œê°**: ì›€ì§ì„ ë°˜ì‘ ì¥ë‚œê°
5. **ìŠ¤ë§ˆíŠ¸ í™ˆ**: ì°½ë¬¸/ë¬¸ ê°œí ê°ì§€

## ğŸ” ë””ë°”ìš´ì‹± ìƒì„¸

### ë°”ìš´ì‹± í˜„ìƒ

```
              ì‹¤ì œ ì ‘ì´‰ì 
     _______      ___________
     |     |      |
     |     |______|
     
     ê¸°ê³„ì  ë°”ìš´ì‹±
     _____   _   ___________
     |   | | | |
     |   |_| |_|
     
     0   5  10 15 20        (ms)
```

### ì†Œí”„íŠ¸ì›¨ì–´ ë””ë°”ìš´ì‹±

```c
#define DEBOUNCE_DELAY_MS   50

/* ì¸í„°ëŸ½íŠ¸ ë‚´ì—ì„œ ì‹œê°„ ì²´í¬ */
if ((current_time - last_interrupt_time) > DEBOUNCE_DELAY_MS) {
    /* ìœ íš¨í•œ ìƒíƒœ ë³€í™”ë¡œ ì²˜ë¦¬ */
}
```

## âš ï¸ ì£¼ì˜ì‚¬í•­

- ê°•í•œ ì§„ë™ í™˜ê²½ì—ì„œëŠ” ì˜¤ë™ì‘ ê°€ëŠ¥
- ìˆ˜í‰ ê°ì§€ê°€ í•„ìš”í•˜ë©´ ê°€ì†ë„ ì„¼ì„œ ê³ ë ¤
- ì •ë°€í•œ ê°ë„ ì¸¡ì •ì—ëŠ” ë¶€ì í•© (ON/OFFë§Œ ê°ì§€)
- ì ‘ì  ì‚°í™” ë°©ì§€ë¥¼ ìœ„í•´ ë°€ë´‰ëœ ëª¨ë“ˆ ê¶Œì¥

## ğŸ“š ì°¸ê³  ìë£Œ

- [STM32F103 Reference Manual](https://www.st.com/resource/en/reference_manual/rm0008-stm32f101xx-stm32f102xx-stm32f103xx-stm32f105xx-and-stm32f107xx-advanced-armbased-32bit-mcus-stmicroelectronics.pdf)
- [NUCLEO-F103RB User Manual](https://www.st.com/resource/en/user_manual/um1724-stm32-nucleo64-boards-mb1136-stmicroelectronics.pdf)
- [KY-020 Tilt Switch Datasheet](https://arduinomodules.info/ky-020-tilt-switch-module/)

## ğŸ“ ë¼ì´ì„ ìŠ¤

MIT License - ììœ ë¡­ê²Œ ì‚¬ìš©, ìˆ˜ì •, ë°°í¬ ê°€ëŠ¥
