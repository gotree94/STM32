# λ³Ό μ¤μ„μΉ λ¨λ“ (Ball/Vibration Switch Module) - STM32F103

## π“‹ κ°μ”

<img width="200" height="200" alt="KY-002" src="https://github.com/user-attachments/assets/9e64d311-7849-4085-ad3e-db9b87f27555" />

* λ³Ό μ¤μ„μΉ λ¨λ“(KY-002)μ€ λ‚΄λ¶€μ κΈμ† λ³Όμ΄ μ§„λ™μ΄λ‚ μ¶©κ²©μ— μν•΄ μ›€μ§μ—¬ μκ°„μ μΌλ΅ μ ‘μ μ„ μ—°κ²°ν•λ” μ„Όμ„μ…λ‹λ‹¤. 
* μ§„λ™, μ¶©κ²©, λ…Έν¬ λ“±μ κ°μ§€μ— ν™μ©λ©λ‹λ‹¤.

## π”§ ν•λ“μ›¨μ–΄ κµ¬μ„±


<img width="644" height="586" alt="F103RB-pin" src="https://github.com/user-attachments/assets/8143b40f-9914-4e1a-8ffd-6a06d699194b" />


### μ„Όμ„ λ¨λ“ μ‚¬μ–‘

| ν•­λ© | μ‚¬μ–‘ |
|------|------|
| λ™μ‘ μ „μ•• | 3.3V ~ 5V |
| μ¶λ ¥ νƒ€μ… | λ””μ§€ν„Έ (ν„μ¤) |
| κ°λ„ | μ•½κ°„μ μ§„λ™/μ¶©κ²©μ— λ°μ‘ |
| μ‘λ‹µ μ‹κ°„ | < 1ms |
| μ¶λ ¥ μ‹ νΈ | ν‰μƒμ‹ HIGH, κ°μ§€ μ‹ LOW ν„μ¤ |

### ν•€ μ—°κ²°

```
Ball Switch Module          NUCLEO-F103RB
==================          ===============
    S (Signal)  --------->  PA0 (EXTI0)
    + (VCC)     --------->  3.3V
    - (GND)     --------->  GND
```

### λ‚΄λ¶€ κµ¬μ΅°

```
    β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
    β”‚    Spring       β”‚
    β”‚      β”‚          β”‚
    β”‚    β”β”€β”΄β”€β”        β”‚
    β”‚    β”‚ β—‹ β”‚ Ball   β”‚
    β”‚    β””β”€β”¬β”€β”        β”‚
    β”‚      β”‚          β”‚
    β”‚  β•β•β•β•β•β•β•β•β•      β”‚
    β”‚   Contact       β”‚
    β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
    
    μ§„λ™/μ¶©κ²© μ‹ λ³Όμ΄ μ›€μ§μ—¬
    μ ‘μ μ— μκ°„ μ ‘μ΄‰
```

## π’» μ†ν”„νΈμ›¨μ–΄ κµ¬μ„±

### μ£Όμ” κΈ°λ¥

1. **μ™Έλ¶€ μΈν„°λ½νΈ κ°μ§€**: ν•κ°• μ—£μ§€(Falling Edge) νΈλ¦¬κ±°
2. **κ°λ„ μ΅°μ **: μ—°μ† νΈλ¦¬κ±° λ°©μ§€ νƒ€μ΄λ¨Έ
3. **κ°•λ„ μ¶”μ •**: λ‹¨μ„ μ‹κ°„λ‹Ή μ΄λ²¤νΈ μ κ³„μΈ΅
4. **μ‹κ°ν™”**: μ§„λ™ κ°•λ„ λ°” κ·Έλν”„ μ¶λ ¥

### ν•µμ‹¬ μ½”λ“ μ„¤λ…

```c
#define SENSITIVITY_MS      100    /* κ°λ„ μ΅°μ  */

void HAL_GPIO_EXTI_Callback(uint16_t GPIO_Pin) {
    if (GPIO_Pin == BALL_SWITCH_PIN) {
        uint32_t current_time = HAL_GetTick();
        
        /* κ°λ„ μ΅°μ : μΌμ • μ‹κ°„ λ‚΄ μ¬νΈλ¦¬κ±° λ¬΄μ‹ */
        if ((current_time - last_shock_time) > SENSITIVITY_MS) {
            shock_count++;
            shock_detected = 1;
            last_shock_time = current_time;
        }
    }
}
```

### κ°λ„ μ„¤μ • κ°€μ΄λ“

| SENSITIVITY_MS | μ©λ„ |
|----------------|------|
| 50ms | λ§¤μ° λ―Όκ° (λ―Έμ„Έ μ§„λ™ κ°μ§€) |
| 100ms | μΌλ° (κ¶μ¥) |
| 200ms | λ‚®μ€ κ°λ„ (κ°•ν• μ¶©κ²©λ§) |
| 500ms | λ…Έν¬ κ°μ§€μ© |

## π“ ν”„λ΅μ νΈ κµ¬μ΅°

```
03_ball_switch/
β”β”€β”€ main.c              # λ©”μΈ μ• ν”λ¦¬μΌ€μ΄μ…
β”β”€β”€ README.md           # ν”„λ΅μ νΈ λ¬Έμ„
β””β”€β”€ STM32CubeIDE/       # (μ„ νƒ) IDE ν”„λ΅μ νΈ νμΌ
```

## π€ λΉλ“ λ° μ‹¤ν–‰

### STM32CubeIDE μ‚¬μ©

1. μƒ STM32 ν”„λ΅μ νΈ μƒμ„± (NUCLEO-F103RB μ„ νƒ)
2. `main.c` λ‚΄μ©μ„ ν”„λ΅μ νΈμ— λ³µμ‚¬
3. λΉλ“ λ° λ‹¤μ΄λ΅λ“

### μμƒ μ¶λ ¥

```
========================================
  Ball/Vibration Switch Module Test
  Board: NUCLEO-F103RB
========================================

Tap or shake the sensor to detect vibration.
Sensitivity: 100ms between detections

[    1] SHOCK! β–
[    2] SHOCK! β–β–
[    3] SHOCK! β–β–β–
  β””β”€ Intensity this second: 3 events
[    4] SHOCK! β–
[    5] SHOCK! β–β–β–β–β–β–
  β””β”€ Intensity this second: 2 events
```

## π― λ™μ‘ μ›λ¦¬

### μ‹ νΈ νƒ€μ΄λ°

```
        μ •μ§€ μƒνƒ        μ¶©κ²© λ°μƒ         λ³µκ·€
            β”‚               β”‚               β”‚
    HIGH β”€β”€β”€β”΄β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”¬β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”΄β”€β”€β”€ HIGH
                            β”‚
    LOW                     β””β”€β”  β† ν„μ¤ (1~10ms)
                              β”‚
                              β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€
                              
    μΈν„°λ½νΈ β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β—β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€
                           νΈλ¦¬κ±°
```

### μ§„λ™ κ°•λ„ μΈ΅μ • μ›λ¦¬

```
    μ•½ν• μ§„λ™                    κ°•ν• μ§„λ™
    
    β”‚  β”‚                        β”‚β”‚β”‚β”‚β”‚β”‚
    β”‚  β”‚                        β”‚β”‚β”‚β”‚β”‚β”‚
    β†“  β†“                        β†“β†“β†“β†“β†“β†“
    
    2 events/sec                6 events/sec
    β–β–                          β–β–β–β–β–β–
```

## π“ μ‘μ© μ•„μ΄λ””μ–΄

1. **λ…Έν¬ κ°μ§€ λ„μ–΄λ½**: νΉμ • λ…Έν¬ ν¨ν„΄ μΈμ‹
2. **λ‚™ν• κ°μ§€**: μ ν’ λ°°μ†΅ μ¤‘ μ¶©κ²© λ¨λ‹ν„°λ§
3. **μ§€μ§„ κ°μ§€κΈ°**: μ§„λ™ κ°•λ„ κΈ°λ΅
4. **κ²μ„ μ»¨νΈλ΅¤λ¬**: λ‘λ“λ¦Ό κΈ°λ° μ…λ ¥
5. **λ„λ‚ λ°©μ§€**: λ¬Όμ²΄ μ΄λ™/μ§„λ™ κ°μ§€ μ•λ

### λ…Έν¬ ν¨ν„΄ μΈμ‹ μμ 

```c
/* 3λ² λ…Έν¬ κ°μ§€ */
#define KNOCK_PATTERN_COUNT  3
#define KNOCK_WINDOW_MS      2000

uint32_t knock_times[3];
uint8_t knock_index = 0;

void check_knock_pattern(void) {
    knock_times[knock_index++] = HAL_GetTick();
    
    if (knock_index >= KNOCK_PATTERN_COUNT) {
        /* 3λ²μ λ…Έν¬κ°€ 2μ΄ μ΄λ‚΄μ— λ°μƒν–λ”μ§€ ν™•μΈ */
        if (knock_times[2] - knock_times[0] < KNOCK_WINDOW_MS) {
            printf("Knock pattern detected!\r\n");
            /* λ„μ–΄ μ—΄κΈ° λ“±μ λ™μ‘ */
        }
        knock_index = 0;
    }
}
```

## β οΈ μ£Όμμ‚¬ν•­

- λ§¤μ° λ―Όκ°ν•λ―€λ΅ μΌ€μ΄λΈ” μ§„λ™μΌλ΅λ„ μ¤μ‘λ™ κ°€λ¥
- κ³ μ • λΈλν‚· μ‚¬μ©ν•μ—¬ μ•μ •μ μΌλ΅ μ„¤μΉ
- μ°¨λ‰ λ“± μ§„λ™ ν™κ²½μ—μ„λ” κ°λ„ μ΅°μ  ν•„μ”
- μ ‘μ  λ°”μ΄μ‹±μ΄ μ‹¬ν•  μ μμΌλ―€λ΅ λ””λ°”μ΄μ‹± ν•„μ

## π” κ°λ„ μ¤μ„μΉμ™€μ λΉ„κµ

| νΉμ„± | λ³Ό μ¤μ„μΉ | κ°λ„ μ¤μ„μΉ |
|------|----------|-------------|
| κ°μ§€ λ°©μ‹ | μ§„λ™/μ¶©κ²© | κΈ°μΈκΈ° |
| μ¶λ ¥ | μκ°„ ν„μ¤ | μ§€μ† μƒνƒ |
| λ―Όκ°λ„ | λ§¤μ° λ†’μ | μ¤‘κ°„ |
| μ©λ„ | μ¶©κ²© κ°μ§€ | μμ„Έ κ°μ§€ |
| μ•μ •μ„± | λ‚®μ | λ†’μ |

## π“ μ°Έκ³  μλ£

- [STM32F103 Reference Manual](https://www.st.com/resource/en/reference_manual/rm0008-stm32f101xx-stm32f102xx-stm32f103xx-stm32f105xx-and-stm32f107xx-advanced-armbased-32bit-mcus-stmicroelectronics.pdf)
- [NUCLEO-F103RB User Manual](https://www.st.com/resource/en/user_manual/um1724-stm32-nucleo64-boards-mb1136-stmicroelectronics.pdf)
- [KY-002 Vibration Switch Datasheet](https://arduinomodules.info/ky-002-vibration-switch-module/)

## π“ λΌμ΄μ„ μ¤

MIT License - μμ λ΅­κ² μ‚¬μ©, μμ •, λ°°ν¬ κ°€λ¥
