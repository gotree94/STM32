# Heartbeat/Pulse Sensor Module - STM32F103 Test

## ğŸ“Œ ê°œìš”

ì‹¬ë°•/í„ìŠ¤ ì„¼ì„œ ëª¨ë“ˆì„ NUCLEO-F103RB ë³´ë“œì— ì—°ê²°í•˜ì—¬ ì‹¬ë°•ìˆ˜ë¥¼ ì¸¡ì •í•˜ëŠ” í”„ë¡œì íŠ¸ì…ë‹ˆë‹¤. ê´‘í•™ ë°©ì‹ìœ¼ë¡œ ì†ê°€ë½ ëì˜ í˜ˆë¥˜ ë³€í™”ë¥¼ ê°ì§€í•˜ì—¬ BPM(Beats Per Minute)ì„ ê³„ì‚°í•©ë‹ˆë‹¤.

## ğŸ”§ í•˜ë“œì›¨ì–´ êµ¬ì„±

### í•„ìš” ë¶€í’ˆ
| ë¶€í’ˆ | ìˆ˜ëŸ‰ | ì„¤ëª… |
|------|------|------|
| NUCLEO-F103RB | 1 | STM32F103RB ê°œë°œë³´ë“œ |
| Pulse Sensor Module | 1 | ì‹¬ë°• ì„¼ì„œ ëª¨ë“ˆ (KY-039 ë“±) |
| Jumper Wires | 3 | ì—°ê²°ìš© ì í¼ì„  |

### í•€ ì—°ê²°

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Pulse Sensor   â”‚         â”‚  NUCLEO-F103RB   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤         â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚     VCC     â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€ 3.3V         â”‚
â”‚     GND     â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€ GND          â”‚
â”‚     S (Signal)â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€ PA0 (ADC)    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚                  â”‚
                            â”‚     PA5 â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚â”€â”€â”€â”€ Built-in LED
                            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### íšŒë¡œë„

```
       +3.3V
         â”‚
    â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”
    â”‚  Pulse  â”‚
    â”‚ Sensor  â”‚
    â”‚  â”Œâ”€â”€â”€â”  â”‚         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  â”‚LEDâ”‚  â”‚         â”‚          â”‚
    â”‚  â”‚   â”‚  â”‚         â”‚   STM32  â”‚
    â”‚  â””â”€â”€â”€â”˜  â”‚         â”‚          â”‚
    â”‚    Sâ”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ PA0(ADC) â”‚
    â”‚         â”‚         â”‚          â”‚
    â”‚   GNDâ”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ GND      â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ“‚ í”„ë¡œì íŠ¸ êµ¬ì¡°

```
heartbeat/
â”œâ”€â”€ main.c          # ë©”ì¸ ì†ŒìŠ¤ ì½”ë“œ
â”œâ”€â”€ README.md       # í”„ë¡œì íŠ¸ ë¬¸ì„œ
â””â”€â”€ Makefile        # ë¹Œë“œ ì„¤ì • (ì„ íƒ)
```

## ğŸ’» ì†Œí”„íŠ¸ì›¨ì–´ ë™ì‘

### ë™ì‘ ì›ë¦¬
1. **ADC ìƒ˜í”Œë§**: 10ms ê°„ê²©ìœ¼ë¡œ ì„¼ì„œ ê°’ ì½ê¸°
2. **í”¼í¬ ê°ì§€**: ì„ê³„ê°’ êµì°¨ ë°©ì‹ìœ¼ë¡œ ì‹¬ë°• ê°ì§€
3. **BPM ê³„ì‚°**: ìµœê·¼ 5íšŒ ì‹¬ë°• ê°„ê²© í‰ê· ìœ¼ë¡œ ê³„ì‚°
4. **ì¶œë ¥**: LED ê¹œë¹¡ì„ ë° UARTë¡œ ì‹¤ì‹œê°„ ë°ì´í„° ì¶œë ¥

### ì•Œê³ ë¦¬ì¦˜

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  ADC ì‹ í˜¸ íŒŒí˜•                   â”‚
â”‚                                                 â”‚
â”‚     Peak â”€â–º  â•±â•²      â•±â•²      â•±â•²               â”‚
â”‚ High â”€â”€â”€â”€â”€â”€â”€â”€/â”€â”€\â”€â”€â”€â”€/â”€â”€\â”€â”€â”€â”€/â”€â”€\â”€â”€â”€â”€ 2200     â”‚
â”‚            /    \  /    \  /    \              â”‚
â”‚ Low  â”€â”€â”€â”€â”€/â”€â”€â”€â”€â”€â”€\/â”€â”€â”€â”€â”€â”€\/â”€â”€â”€â”€â”€â”€\â”€â”€â”€ 1800     â”‚
â”‚          â”‚      â”‚ â”‚      â”‚ â”‚      â”‚            â”‚
â”‚        Beat   Beat     Beat                    â”‚
â”‚                                                 â”‚
â”‚   Interval â”œâ”€â”€â”€â”€â”€â”€â”¤                            â”‚
â”‚   BPM = 60000 / Interval(ms)                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### íŒŒë¼ë¯¸í„° ì„¤ì •
| íŒŒë¼ë¯¸í„° | ê¸°ë³¸ê°’ | ì„¤ëª… |
|----------|--------|------|
| `THRESHOLD_HIGH` | 2200 | ìƒìœ„ ì„ê³„ê°’ (Beat ì‹œì‘) |
| `THRESHOLD_LOW` | 1800 | í•˜ìœ„ ì„ê³„ê°’ (Beat ì¢…ë£Œ) |
| `MIN_BEAT_INTERVAL` | 300ms | ìµœì†Œ ë°•ë™ ê°„ê²© (200 BPM) |
| `MAX_BEAT_INTERVAL` | 2000ms | ìµœëŒ€ ë°•ë™ ê°„ê²© (30 BPM) |
| `BPM_AVERAGE_COUNT` | 5 | í‰ê·  ê³„ì‚° ìƒ˜í”Œ ìˆ˜ |

> âš ï¸ **ì£¼ì˜**: ì„ê³„ê°’ì€ ì„¼ì„œì™€ í™˜ê²½ì— ë”°ë¼ ì¡°ì •ì´ í•„ìš”í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

## ğŸš€ ë¹Œë“œ ë° ì‹¤í–‰

### STM32CubeIDE ì‚¬ìš©

1. **ìƒˆ í”„ë¡œì íŠ¸ ìƒì„±**
   - File â†’ New â†’ STM32 Project
   - Board Selectorì—ì„œ NUCLEO-F103RB ì„ íƒ

2. **í•€ ì„¤ì • (CubeMX)**
   - PA0: ADC1_IN0
   - PA5: GPIO_Output (LED)
   - USART2: Asynchronous, 115200 baud
   - ADC1: Enable, 12-bit resolution

3. **ì½”ë“œ ì¶”ê°€**
   - `main.c` ë‚´ìš©ì„ ìƒì„±ëœ í”„ë¡œì íŠ¸ì— ì ìš©

4. **ë¹Œë“œ ë° ë‹¤ìš´ë¡œë“œ**
   - Project â†’ Build All
   - Run â†’ Debug

### ì‹œë¦¬ì–¼ ëª¨ë‹ˆí„° ì„¤ì •
- Baud Rate: 115200
- Data Bits: 8
- Stop Bits: 1
- Parity: None

## ğŸ“Š ì¶œë ¥ ì˜ˆì‹œ

```
========================================
  Heartbeat/Pulse Sensor Module Test
  NUCLEO-F103RB
========================================
Place your finger on the sensor...
Wait for stable readings (10-20 sec)

[RAW] ADC Value: 1856 | Current BPM:   0
[RAW] ADC Value: 1923 | Current BPM:   0
[BEAT] ADC: 2287 | Interval:  857 ms | BPM:  70
[RAW] ADC Value: 1834 | Current BPM:  70
[BEAT] ADC: 2301 | Interval:  842 ms | BPM:  71
[BEAT] ADC: 2256 | Interval:  867 ms | BPM:  69
[RAW] ADC Value: 1912 | Current BPM:  69
```

## ğŸ” íŠ¸ëŸ¬ë¸”ìŠˆíŒ…

| ë¬¸ì œ | ì›ì¸ | í•´ê²° ë°©ë²• |
|------|------|----------|
| ADC ê°’ì´ 0 ë˜ëŠ” 4095 | ë°°ì„  ì˜¤ë¥˜ | ì—°ê²° í™•ì¸ |
| BPMì´ ê³„ì‚°ë˜ì§€ ì•ŠìŒ | ì„ê³„ê°’ ë¶€ì ì ˆ | ì‹œë¦¬ì–¼ë¡œ RAW ê°’ í™•ì¸ í›„ ì„ê³„ê°’ ì¡°ì • |
| ë¶ˆì•ˆì •í•œ BPM | ì†ê°€ë½ ì›€ì§ì„ | ì†ê°€ë½ì„ ê°€ë§Œíˆ ìœ ì§€ |
| ë„ˆë¬´ ë†’ì€ BPM | ì£¼ë³€ê´‘ ê°„ì„­ | ì†ê°€ë½ìœ¼ë¡œ ì„¼ì„œë¥¼ ì™„ì „íˆ ë®ê¸° |
| ADC ê°’ ë³€í™” ì—†ìŒ | ì„¼ì„œ ë¶ˆëŸ‰ | ì„¼ì„œ LED ì ë“± í™•ì¸ |

### ì„ê³„ê°’ íŠœë‹ ê°€ì´ë“œ
1. ë¨¼ì € RAW ì¶œë ¥ìœ¼ë¡œ ADC ë²”ìœ„ í™•ì¸
2. ìµœëŒ€ê°’ì˜ 70-80%ë¥¼ `THRESHOLD_HIGH`ë¡œ ì„¤ì •
3. ìµœì†Œê°’ì˜ 110-120%ë¥¼ `THRESHOLD_LOW`ë¡œ ì„¤ì •

## ğŸ“ˆ ì‹¬ë°•ìˆ˜ ì°¸ê³ ì¹˜

| ìƒíƒœ | BPM ë²”ìœ„ |
|------|----------|
| ì•ˆì •ì‹œ (ì„±ì¸) | 60-100 |
| ìˆ˜ë©´ ì¤‘ | 40-60 |
| ìš´ë™ ì¤‘ | 100-170 |
| ìµœëŒ€ ì‹¬ë°•ìˆ˜ | 220 - ë‚˜ì´ |

## ğŸ“š ì°¸ê³  ìë£Œ

- [STM32F103 Reference Manual](https://www.st.com/resource/en/reference_manual/rm0008-stm32f101xx-stm32f102xx-stm32f103xx-stm32f105xx-and-stm32f107xx-advanced-armbased-32bit-mcus-stmicroelectronics.pdf)
- [NUCLEO-F103RB User Manual](https://www.st.com/resource/en/user_manual/um1724-stm32-nucleo64-boards-mb1136-stmicroelectronics.pdf)
- [Pulse Sensor Playground (Arduino)](https://pulsesensor.com/)

## ğŸ“ ë¼ì´ì„ ìŠ¤

MIT License

## âœï¸ ì‘ì„±ì

Embedded Systems Lab - 2025
